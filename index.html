
<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä</title>

</head>
<body>
     <div class="Menu">
        <button class="UpButton">üìÅ –ì—Ä—É–ø–ø—ã</button>
        <div id="currentGroup" style="color: #888; font-size: 14px;">–û—Å–Ω–æ–≤–Ω–∞—è</div>
    </div>

    <div class="groups-modal">
        <button class="create-group-btn" id="createGroupBtn">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É</button>
        <input type="text" class="group-input" id="groupInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã...">
        <div class="group-list" id="groupList"></div>
    </div>

    <div class="Money">
        <h3 class="Info">–ë–∞–ª–∞–Ω—Å –≥—Ä—É–ø–ø—ã:</h3>
        <div id="totalAmount">0 ‚ÇΩ</div>
    </div>

    <div class="logs-container">
        <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</div>
        <div id="logsList"></div>
    </div>

    <div class="MainButtons">
        <button class="Pribl">‚ûï –ü—Ä–∏–±—ã–ª—å</button>
        <button class="Minus">‚ûñ –†–∞—Å—Ö–æ–¥</button>
    </div>

    <div class="amount-modal" id="amountModal">
        <div class="amount-content">
            <h3 style="margin-bottom: 20px; color: #ddd;" id="modalTitle">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É</h3>
            <input type="number" class="amount-input" id="amountInput" placeholder="0" min="0" step="0.01">
            <textarea class="comment-input" id="commentInput" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–∫—É–¥–∞ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏/–æ—Ç–∫—É–¥–∞ –ø–æ–ª—É—á–∏–ª–∏)..."></textarea>
            <div class="amount-actions">
                <button class="amount-btn cancel" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="amount-btn confirm" id="confirmBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>
     <script>

Telegram.WebApp.ready();
Telegram.WebApp.expand();



let currentOperation = null;
let currentGroup = '–û—Å–Ω–æ–≤–Ω–∞—è';


let groups =  {
    '–û—Å–Ω–æ–≤–Ω–∞—è': { balance: 0, logs: [] }
};
$('.Pribl').click(function() {
        currentOperation = 'plus';
        $('#modalTitle').text('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø—Ä–∏–±—ã–ª–∏');
        $('#amountInput').val('');
        $('#commentInput').val('');
        $('#amountModal').addClass('active');
        $('#amountInput').focus();
    });

$('.Minus').click(function() {
    currentOperation = 'minus';
    $('#modalTitle').text('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —Ä–∞—Å—Ö–æ–¥–∞');
    $('#amountInput').val('');
    $('#commentInput').val('');
    $('#amountModal').addClass('active');
    $('#amountInput').focus();
});

    $('#cancelBtn').click(function() {
         $('#amountModal').removeClass('active');
        currentOperation = null;
    });

    $(document).click(function(e) {
        if (!$(e.target).closest('.groups-modal, .UpButton').length) {
            $('.groups-modal').removeClass('active');
        }
        if ($(e.target).hasClass('amount-modal')) {
            $('#amountModal').removeClass('active');
        }
            });

     $('#confirmBtn').click(function() {
        const amount = parseFloat($('#amountInput').val());
        const comment = $('#commentInput').val().trim();

        if (amount && amount > 0 && currentOperation) {
            addLog(currentOperation, amount, comment);
            $('#amountModal').removeClass('active');
            currentOperation = null;



        } else if (!amount || amount <= 0) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
        }
    });

    function addLog(type, amount, comment) {
                const date = new Date();
                const log = {
                    id: Date.now(),
                    type: type,
                    amount: amount,
                    comment: comment || `${Telegram.WebAppData.id}`,
                    date: date.toLocaleString('ru-RU')
                };

                groups[currentGroup].logs.unshift(log);


                if (type === 'plus') {
                    groups[currentGroup].balance += amount;
                } else {
                    groups[currentGroup].balance -= amount;
                }
                updateGroupBalance();
                renderLogs();
            }

    function renderLogs() {
        $('#logsList').empty();
        const currentLogs = groups[currentGroup].logs;

        if (currentLogs.length === 0) {
            $('#logsList').html('<div class="empty-logs">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ</div>');
            return;
        }

        currentLogs.forEach(log => {
            const isPlus = log.type === 'plus';
            $('#logsList').append(`
                <div class="log-item ${isPlus ? '' : 'minus'}">
                    <div class="log-details">
                        <div class="log-comment">${log.comment}</div>
                        <div class="log-date">${log.date}</div>
                    </div>
                    <div class="log-amount ${isPlus ? 'plus' : 'minus'}">
                        ${isPlus ? '+' : '-'}${log.amount} ‚ÇΩ
                    </div>
                </div>
            `);
        });
    }
    function updateGroupBalance() {
        const balance = groups[currentGroup].balance;
        $('#totalAmount').text(`${balance >= 0 ? '' : '-'}${Math.abs(balance).toFixed(2)} ‚ÇΩ`);

                if (balance >= 0) {
                    $('#totalAmount').css('background', 'linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%)');
                } else {
                    $('#totalAmount').css('background', 'linear-gradient(135deg, #ff4757 0%, #c44569 100%)');
                }
                $('#totalAmount').css('-webkit-background-clip', 'text');
                $('#totalAmount').css('-webkit-text-fill-color', 'transparent');
            }
     </script>

</body>

</html>
